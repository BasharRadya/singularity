### E2 - Your first kernel module üçø

You will specify, implement, and testing a kernel module that implements a simple interface in the Linux kernel's [`/proc` filesystem](https://docs.kernel.org/filesystems/proc.html).

#### Outcomes:
* Get comfortable writing a simple software specification
* Get comfortable implementing software from a specification in the context of a kernel module
* Get familiar with Linux's [`/proc` filesystem](https://docs.kernel.org/filesystems/proc.html)
* Get familiar with software testing in the context of Linux kernel modules

#### Patches to submit:

With `$USER` as your KDLP username:

0. Create `e2/$USER/Makefile`

Requirements for this patch:
* Invocation of `make`, `make all`, or `make build` in the assignment directory attempts to build a kernel module named `proc_driver.ko` from a source file named `proc_driver.c` in the assignment directory
* Invocation of `make clean` removes any files related to a previous build of `proc_driver.ko`

0. Create `e2/$USER/proc_driver.c`

Requirements for this patch:

* Invocation of `make` in the assignment directory builds a kernel module object file named `proc_driver.ko` with no warnings or errors of any kind.
* (Subject to change) Insertion of `proc_driver.ko` creates the file `/proc/kdlp` on a system.
* (Subject to change) This file implements an interface that the instructors will specify clearly here as we get closer to this assignment.

0. Create `e2/$USER/test_proc_driver.c` and enable usage of `make test`

Requirements for this patch:

* Invocation of `make test` in the assignment directory builds an executable file named `./test_proc_driver`
* Testing functions implemented `./test_proc_driver.c` validate the specified behavior of `/proc/kdlp`

*As always don't forget the cover letter.*


#### Procedure:
0. Setup your develoment environment

Before doing anything else, create your `e2/firstname_lastname` directory in the [`ILKD_assignments`](https://kdlp.underground.software/cgit/ILKD_assignments) repository and create a simple `Makefile` for the assignment. You can build simple kernel modules using a fairly boilerplate set of targets. The following is sufficient to build a kernel module object file `module.ko` from a source file `module.c`:


**Makefile**

	obj-m += module.o

	.PHONY: build clean load unload

	build:
	    make -C /lib/modules/$(shell uname -r)/build modules M=$(PWD)

	clean:
	    make -C /lib/modules/$(shell uname -r)/build clean M=$(PWD)

	load:
	    sudo insmod module.ko
	unload:
	    -sudo rmmod module

Before continuing, you should run `make build`, `make load`, `make unload`, and `make clean` in your directory with a hello world module to validate your development environment. Something like this is sufficient:

**hello.c**

```
#include <linux/init.h>
#include <linux/module.h>

MODULE_LICENSE("GPL");

static int hello_init(void)
{
    printk(KERN_ALERT "Hello, world\n");
    return 0;
}

static void hello_exit(void)
{
    printk(KERN_ALERT "Goodbye, cruel world\n");
}
module_init(hello_init);
module_exit(hello_exit);
```

Save this as `hello.c` and change the first line of your Makefile to `obj-m += hello.o`.

0. Once you are sure the bugs that follow are of your own making by taking the above steps, implement the driver and tests.

0. Keep your changes in source control as you go, even if you need to temporarily dirty the git history while figuring things out

0. Format your work as the three patches specified above. Locally run [`scripts/checkpatch.pl`](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/scripts/checkpatch.pl) in the kernel tree on your patches and apply them to a `branch` made freshly using `git checkout -b <branch> origin/master`.

0. Submit your patches to `e2@kdlp.underground.software` by the due date.

[Submission Guidelines](../policies/submission_guidelines.md)
